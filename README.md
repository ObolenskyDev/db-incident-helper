# üêò Database Incident Helper

![Bash](https://img.shields.io/badge/Shell-Bash-4EAA25?style=flat&logo=gnu-bash)
![Python](https://img.shields.io/badge/Python-3.8%2B-3776AB?style=flat&logo=python)
![PostgreSQL](https://img.shields.io/badge/DB-PostgreSQL-336791?style=flat&logo=postgresql&logoColor=white)
![License](https://img.shields.io/badge/License-MIT-blue.svg)

–ù–∞–±–æ—Ä –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö —É—Ç–∏–ª–∏—Ç –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–∞ **L3 Support**.
–ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –°–£–ë–î (PostgreSQL/MariaDB), –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –≤ **Kaspersky Security Center (Linux)**. –ü–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Å–æ–ª–∏ –∏–ª–∏ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

---

## üì∏ –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
*(–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –∂–∏–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)*

![Execution Result](demo_run.png)

---

## üõ†Ô∏è –°–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

### 1. `pg_health.sh` (Bash)
–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ "–∑–¥–æ—Ä–æ–≤—å—è" –∏–Ω—Å—Ç–∞–Ω—Å–∞ –ë–î.
* **Service Check:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å systemd-—é–Ω–∏—Ç–∞ (postgresql/mariadb), –≤—ã–≤–æ–¥–∏—Ç –∞–ø—Ç–∞–π–º.
* **Port Listener:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ss` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤ 5432/3306 (–∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Ñ–∞–µ—Ä–≤–æ–ª–∞).
* **Disk Usage:** –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –≤ `/var/lib/postgresql`. –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è KSC, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–∏—Å–∫–∞ –±–∞–∑–∞ –∞–≤–∞—Ä–∏–π–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

### 2. `slow_query_parser.py` (Python)
–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∂—É—Ä–Ω–∞–ª–æ–≤ PostgreSQL (`postgresql-*.log`) –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
* **Log Parsing:** –ò—â–µ—Ç –∑–∞–ø–∏—Å–∏ —Å –º–µ—Ç–∫–æ–π `duration`, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –∑–∞–¥–∞–Ω–Ω—ã–π –ø–æ—Ä–æ–≥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000 –º—Å).
* **Reporting:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–¥–∫—É —Ç–æ–ø-5 —Å–∞–º—ã—Ö "—Ç—è–∂–µ–ª—ã—Ö" –∑–∞–ø—Ä–æ—Å–æ–≤, –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
* **Demo Mode:** –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –ª–æ–≥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.

---

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# 1. –≠–∫—Å–ø—Ä–µ—Å—Å-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –°–£–ë–î
sudo ./pg_health.sh

# 2. –ü–æ–∏—Å–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–¥–ª–µ–Ω–Ω–µ–µ 2 —Å–µ–∫—É–Ω–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ª–æ–≥–µ
python3 slow_query_parser.py /var/log/postgresql/postgresql-14-main.log 2000

# 3. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
python3 slow_query_parser.py